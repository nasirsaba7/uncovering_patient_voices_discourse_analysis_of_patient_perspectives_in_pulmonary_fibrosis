import re
from gensim import corpora
from gensim.models.ldamodel import LdaModel
from nltk.corpus import stopwords
from nltk.tokenize import word_tokenize
from nltk.stem import WordNetLemmatizer

# Sample text
text = """
I was diagnosed with pulmonary fibrosis in 2004 and subsequently got Pulmonary Hypertension as well. A year ago I was prescribed Hydroxychloroquine Sulfate. I’m on a drug called nintedanib which I’ve been on for 4 years. I had to have the dose lowered to reduce side effects. We’re both also on long-term oxygen therapy. I’ve been on nintedanib for nearly a year now. The drug isn’t expected to improve things as scarring can’t be reversed but it is hoped it will stop or slow down progression. I did feel better straight away but I am also taking steroids. Ambulatory oxygen is very important – it helps me keep active. I’ve recently been given an Inogen one oxygen concentrator. It only gives oxygen when you breathe through the tubes up your nose. Eventually you become dependent on supplementary oxygen for exercise initially and then 24/7 at home just to stay alive. You’re using your own supports whether it’s your friends, my telephones been burnt out. It’s just staying in touch with people, that’s kind of what gets you through the day. Yoga, meditation, just going out for a walk, I mean all of those things definitely helped. I started with the garden benches [home improvement project]. It’s just something to keep you going... keep the mind busy on something else… The more you sit around watching the television, the more things will get into your mind. There was company, people with the same disease. I found I was looking forward to going. And I thought it was doing me good. Just having a chat about families and how they are coping, you know that’s the biggest part of it. Getting together and talking to people with the same problem. I couldn’t help thinking that [the patient group meeting] is like [Dr Harold Shipman’s] waiting room, waiting for each one to pop off you know. Because there is always news that somebody is gone and that’s a person you know and I think, my name would be there one day wouldn’t it?’ (Dr Harold Shipman was a UK physician convicted of euthanasia of elderly patients) ... [There was a negative] down turn because you all know that you are going sooner than you’d like to be. It’s sort of monitoring yourself and knowing what your capacity is, and if it’s… you’re getting to a… sort of a point where you need to take a break, well take a break you know, that’s all. I guess you learn yourself where those points are. I think by, referring how it affects me to somebody else, may not help them at all, yet it helps me. And that’s why I’m saying, I think it’s sort of very individual. That means that I have to be aware, more aware… and try and make sure [I] eat properly, exercise, monitor my oxygen requirements. I have to, just get into a routine and acceptance of that, and find the little pockets of positivity within that well. Preparing oneself for… acceptance of the illness, not just acceptance of the illness, but acceptance of the illness that where it’s going to take you, as in, in the end, you will die. But um, you can’t just put that out of your mind. I know they (family) care and I know they’re gonna be there for me and that’s a big, a big plus, whether it’s on an emotional level or a physical level, they would do anything to help me that they could. I can now restore my breathing by remaining as calm as possible and inhaling through my nose. […] I find that drinking water and keeping hydrated, having a small, low sugar sweet in my mouth (liquorice is quite effective) and having small meals, help me to reduce my cough. I do find that my mouth dries out so I must do some mouth breathing, cause I’m sort of constantly putting on, you know, lip balm during the day, and at nighttime too. My mother died of lung disease, she had fibrosis, so she had scarring all over her lungs and eventually it covered her lung and I mean, there’s no way you can breathe after a while, and I know this is mind over matter, but do you know those little propeller handheld fans? I mean, this is just mind over matter for sure, but that feeling of air just on her face calmed her down. The decision to start treatment was mine, but it was based on my lung specialist’s advice because I am a layman. I made the decision. I had to make my physician aware of the treatments to get them. I asked the ILD specialist about which drug he would recommend, I was recommended Esbriet. However, I did NOT want to take a treatment that required me taking 9 tablets a day on top of all my heart medication that I already take. My pulmonary fibrosis is due to Rheumatoid Arthritis [RA], the RA is being actively treated but constantly getting pneumonia requiring hospital admissions. A low dose of Baracitinib for my RA. Apparently some rheumatologists don’t like prescribing baricitinib to people with lung conditions but I’ve been taking it for approx. 2 years without any detrimental effect on my lungs so far. My respiratory consultant advised me to stop taking methotrexate which I was on when diagnosed. Rheumy have stopped me taking all other DMARDs too, which I think is because of my pulmonary fibrosis. The lack of multidisciplinary team plays a role here. For instance, physiotherapy is not contemplated as part of the process. The multidisciplinary team should not only include lung specialists, radiologists and pathologists, it should also include physiotherapists. For a few months, I’ve been using ambulatory oxygen. I had struggled with the concept, as I saw it as a sign my condition was progressing. But now I see it as a way of allowing me to continue to do the things I want to do and as an important safeguard. [Being on oxygen] enables you to carry on doing the things that you want to do… at least it enables you to go out and do some exercise… go off to the park, go and see friends… I think the way people think of oxygen needs to change… that it’s a positive thing. I didn’t want to go on oxygen because it was accepting or confirming that I was getting worse. When I look back on it, I should have been on supplementary oxygen 6 months or more before. To slow down the scarring of my lungs, I was prescribed pirfenidone. Initially I had a lot of side effects: nausea, vomiting, diarrhoea and a skin rash which meant I had to put on SPF50 sunscreen whenever I went out in the sun. I also felt very fatigued sometimes and would need to take short breaks during the day. But I tolerated all this as it was slowing the rate of progression of the scarring on my lungs. Corticosteroids made me feel like a balloon. Going out is always a challenge because I worry about running out of oxygen. The three most common challenges I’ve faced are travelling with oxygen, getting the appropriate oxygen for home use, and exercising with oxygen. I was amazed at how useful it was; it told me things I feel my GP should have; things I needed to know. It gave me the confidence to go to the gym, even with my oxygen. I met a friend on the course and we went together and both exercised with our oxygen. At the course I found out breathing techniques that I still use today, years later. It helped me to cope and accept my condition. I did pulmonary rehab and it really helped. But because I’ve already done it, and there’s such a waiting list, I haven’t gone back. The doctor suggested I go again recently, and I said to the doctor I don’t really feel I can do it. Or have the energy. And then my husband would have to drive me, and it’s just sheer distance. What really helped me was going to a pulmonary rehab program. That was a way of being able to start getting back into exercising, and activity, and wellness exercises, and connecting with other people who have lung issues. The fitter your body is, the better you feel both physically and mentally. If you feel better mentally then your whole well-being is more positive and you won’t dwell on the negative sides of the disease. Palliative care can be very useful… you can get medication… assistance, help with nutritional changes, and also participate in relaxation techniques, and get advice on social, emotional and spiritual… Psychological support is very, very important. I often forget to take the one pill I have to take weekly.
I prefer to experience diarrhoea than a headache as my line of work requires lots of concentration. I tend to gain weight — specifically, corticosteroids made me feel like a balloon. I believe that at the end of the day… any side effects worsen quality of life.
If they are all severe, diarrhoea is the hardest… every moment of the day going to the toilet can be embarrassing and hits that physical and pride level.
The most common thing that a lot of people can’t manage is the diarrhoea, because you’re literally at home and you can’t go anywhere.
The sun sensitivity is especially inconvenient as my wife comes from the Caribbean and still wants to travel there and then it would be severe to travel there with such a risk of side effects.
I’m already on a cocktail of pills and taking nine more a day is too much to ask.
However, in June 2017, test results indicated that the medication wasn’t slowing the scarring as much as was hoped. So, I was switched to the only other available and relatively new drug, nintedanib. I was a bit nauseous initially, but I’ve found a good regime and manage my diet.
I was prescribed Esbriet at first but experienced intolerable side effects so the drug was exchanged for OFEV. Is it working? Well, my spirometry test shows little minimal change in the last 6 months.
Some people like me don’t can’t seem to absorb or respond to the Zentevia brand and only do well with the Bristol Brand/Quinoric Brand… Mine was switched in July and I landed up in hospital for 6 weeks. I never dreamt that it could be due to a medication brand switch but it was.
There are only 2 approved medications to help slow the condition and I have been on both – the first, Pirfenidone, was not as effective as hoped and so I was switched to Nintedanib.
Stephen preferred to have diarrhoea and only 2 pills a day instead of vomiting and 9 pills.
Oh, over the phone is perfect for me because I don’t want to be going in there at all… the hospital is the worst place in the world to be in these days.
There was great support in the knowledge that if I was unwell I could ring… That message was re-enforced many times, that if I needed a bit of help, someone to talk to.
Negative
You really do miss those (faceto-face) meetings… when you come away from it, it’s absolutely brilliant, it’s just the confidence.
I’d be praying night and day that there would not be any changes in my condition… I’d be often worried… I would not be able to self-diagnose myself.
For example, if you go to physio, they tell you how to do things [exercises] and then by the time you get home you’ve forgotten it. Whereas, if you’ve got a video, you can always fall back on it and make sure you are doing it correctly.
When you go to the doctors you get like seven minutes, the seven minutes finish and I have forgotten, you know what I mean. If you had something on the internet, you could watch it over and over an explain it, you know what I mean, so you can understand it.
I’ve often wondered to what extent the diagnosis is exactly correct. When I go online and read about my symptoms, I often find that the same symptoms apply to several diseases under the same umbrella. I’m diagnosed with IPF… some of the treatments seem to be a little bit different. It would be probably quite helpful if there were a genetic test that would say, ‘yeah, this is what you have, not that. And so your treatment should be (this).
It would be a real advantage if there was genetic testing developed that might catch something like pulmonary fibrosis right at the very beginning and start treatment right away instead of having it develop and cause lots of scarring before it’s diagnosed.
I think it would depend on how invasive it is and how accurate it is. I wouldn’t want it to leave me with more questions that there are no answers for.
I have siblings, one issue I think is whether … somebody would actually want to know… Some people would want to live their life accordingly. Others, if they think they’re going to get this terrible disease, they’ll be devastated, and it would really negatively affect their quality of life.
The sun sensitivity is especially inconvenient as my wife comes from the Caribbean and still wants to travel there and then it would be severe to travel there with such a risk of side effects.
However, in June 2017, test results indicated that the medication wasn’t slowing the scarring as much as was hoped. So I was switched to the only other available and relatively new drug, nintedanib. I was a bit nauseous initially, but I’ve found a good regime and manage my diet.
I was prescribed Esbriet at first but experienced intolerable side effects so the drug was exchanged for OFEV. Is it working? Well, my spirometry test shows little minimal change in the last 6 months.
Some people like me don’t can’t [sic] seem to absorb or respond to the Zentevia brand and only do well with the Bristol Brand/Quinoric Brand … Mine [medication] was switched in July and I landed up in hospital for 6 weeks. I never dreamt that it could be due to a medication brand switch but it was.
There are only 2 approved medications to help slow the condition and I have been on both – the first, Pirfenidone, was not as effective as hoped and so I was switched to Nintedanib.
Stephen [the patient] preferred to have diarrhoea and only 2 pills a day instead of vomiting and 9 pills.
"""

# Preprocess the text
def preprocess(text):
    # Convert to lowercase
    text = text.lower()
    # Remove punctuation
    text = re.sub(r'\s+', ' ', re.sub(r'[^\w\s]', '', text))
    # Tokenize
    tokens = word_tokenize(text)
    # Remove stopwords
    tokens = [word for word in tokens if word not in stopwords.words('english')]
    # Lemmatize
    lemmatizer = WordNetLemmatizer()
    tokens = [lemmatizer.lemmatize(word) for word in tokens]
    return tokens

# Preprocess the text
processed_text = preprocess(text)

# Create a dictionary and corpus
dictionary = corpora.Dictionary([processed_text])
corpus = [dictionary.doc2bow(processed_text)]

# Perform LDA
lda_model = LdaModel(corpus, num_topics=3, id2word=dictionary, passes=15)

# Display topics
for idx, topic in lda_model.print_topics(-1):
    print(f"Topic {idx}: {topic}")
